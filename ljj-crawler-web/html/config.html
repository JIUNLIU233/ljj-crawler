<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>任务配置</title>
    <link rel="stylesheet" href="../layui/css/layui.css">
</head>
<body>
<div class="layui-collapse">
    <div class="layui-colla-item">
        <h2 class="layui-colla-title">任务基本信息配置</h2>
        <div class="layui-colla-content layui-show">
            <table id="taskInfo" lay-filter="taskInfo"></table>
        </div>
    </div>
    <div class="layui-colla-item">
        <h2 class="layui-colla-title">任务规则配置</h2>
        <div class="layui-colla-content layui-show">
	        <button class="layui-btn" id="addRule">新增规则</button>
	        <table id="taskRule" lay-filter="taskRule"></table>
	        <script type="text/html" id="deleteRule">
		        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del" >删除</a>
	        </script>
	        
        </div>
    </div>
    <div class="layui-colla-item">
        <h2 class="layui-colla-title">任务解析配置</h2>
        <div class="layui-colla-content layui-show">
			<button class="layui-btn" id="addExtract">新增解析规则</button>
	        <table id="extract" lay-filter="extract"></table>
	        <script type="text/html" id="deleteExtract">
		        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del" >删除</a>
	        </script>
	        
        </div>

    </div>
</div>
<script src="../layui/layui.js"></script>
<script>
    //一般直接写在一个js文件中
    layui.use(['layer', 'form', 'element', 'table'], function () {
        var layer = layui.layer
            , form = layui.form
            , table = layui.table
            ,$ = layui.$
            , element = layui.element;


        table.render({
            elem: '#taskInfo'
            , url: ''
            , data: [
                {name: '请输入任务名称', start_url: '请输入任务起始url', have_rule: '1：url有规则，0：url 无规则 '}
            ]
            , cols: [[
                {field: 'name', title: '任务名称', edit: 'text'},
                {field: 'start_url', title: '任务起始url', edit: 'text'},
                {field: 'have_rule', title: 'url 是否含有规则', edit: 'text'}
            ]]
        });

		table.render({
			elem: '#taskRule'
			,url:''
			,data:[
			]
			,cols:[[
				{field: 'param_name', title: '参数名称', edit: 'text'},
				{field: 'rule_type', title: '规则类型', edit: 'text'},
				{field: 'rule_param', title: '用于处理规则的参数信息', edit: 'text'},
				{toolbar:'#deleteRule'}
			]]
		});
		
        table.on('edit(taskInfo)', function (obj) {
            var value = obj.value //得到修改后的值
                , data = obj.data //得到所在行所有键值
                , field = obj.field; //得到字段
            layer.msg(field + ' 字段更改为：' + value);
        });

		// 新增链接规则
		$("#addRule").click(function(){
			var obj = {};
			rules = table.cache.taskRule;
			rules.push(obj);
			table.reload("taskRule",{
				data:rules,
			})
		});

		// 删除链接规则
		table.on('tool(taskRule)',function(obj){
			var data = obj.data;
			if (obj.event == 'del'){
				layer.confirm('确定删除该条配置数据？',function(index){
					obj.del();
					layer.close(index);
				});
			}
		});


		table.render({
			elem: '#extract'
			,url:''
			,data:[
			]
			,cols:[[
				{field: 'field_name', title: '字段名称', edit: 'text'},
				{field: 'extract_type', title: '当前页面类型', edit: 'text'},
				{field: 'extract_attr', title: '解析html标签的属性', edit: 'text'},
				{field: 'extract_param', title: '用于解析的参数', edit: 'text'},
				{field: 'result_type', title: '解析返回的类型', edit: 'text'},
				{field: 'array_range', title: '为数组时，舍弃的头部和尾部', edit: 'text'},
				{toolbar:'#deleteRule'}
			]]
		});

		// 新增链接规则
		$("#addExtract").click(function(){
			var obj = {};
			rules = table.cache.extract;
			rules.push(obj);
			table.reload("extract",{
				data:rules,
			})
		});

		
    });
</script>
</body>

</html>